name: TagVersion

on:
  workflow_call:
    inputs:
      prerelease:
        type: boolean
        required: false
        default: true
    outputs:
      new_tag:
        value: ${{ jobs.tagversion.outputs.new_tag }}
      new_version:
        value: ${{ jobs.tagversion.outputs.new_version }}
      changelog:
        value: ${{ jobs.tagversion.outputs.changelog }}
jobs:
  tagversion:
    runs-on: ubuntu-latest
    name: Tag Version
    steps:
    - name: Determine Suffix
      id: suffix
      run: |
        if ${{ inputs.prerelease }}; then
          echo "PRERELEASE_BRANCH=${{ github.head_ref || github.ref_name }}" >> $GITHUB_OUTPUT
          echo "RELEASE_BRANCH=${{ github.base_ref }}" >> $GITHUB_OUTPUT
        else
          echo "RELEASE_BRANCH=${{ github.head_ref || github.ref_name }}" >> $GITHUB_OUTPUT
        fi
        echo "CUSTOM_RELEASE_RULES=fix:prerelease,feat:prerelease,chore:prerelease" >> $GITHUB_OUTPUT
        
    - name: Bump version
      id: tag_version
      uses: mathieudutour/github-tag-action@fcfbdceb3093f6d85a3b194740f8c6cec632f4e2 # 6.1
      with:
        dry_run: true
        github_token: ${{ secrets.GITHUB_TOKEN }}
         custom_release_rules:"${{ steps.suffix.outputs.CUSTOM_RELEASE_RULES }}"
         pre_release_branches:"${{ steps.suffix.outputs.PRERELEASE_BRANCH }}"
#        release_branches: "${{ steps.suffix.outputs.RELEASE_BRANCH }}"
#        append_to_pre_release_tag: prerelease
        
    - name: Results
      run: |
        echo head_ref:  ${{ github.head_ref }}
        echo base_ref:  ${{ github.base_ref }}
        echo ref:  ${{ github.ref }}
        echo ref_name:  ${{ github.ref_name }}
        echo New Tag:  ${{ steps.tag_version.outputs.new_tag }}
        echo New Version:  ${{ steps.tag_version.outputs.new_version }}
        echo Changelog:  '${{ steps.tag_version.outputs.changelog }}'
        
    outputs:
      new_tag: ${{ steps.tag_version.outputs.new_tag }}
      new_version: ${{ steps.tag_version.outputs.new_version }}
      changelog: ${{ steps.tag_version.outputs.changelog }}
