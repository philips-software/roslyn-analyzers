# PH2159: Consider using combinatorial testing

| Property | Value  |
|--|--|
| Package | [Philips.CodeAnalysis.MsTestAnalyzers](https://www.nuget.org/packages/Philips.CodeAnalysis.MsTestAnalyzers) |
| Diagnostic ID | PH2159 |
| Category  | [MsTest](../MsTest.md) |
| Analyzer | [PreferCombinatorialTestingAnalyzer](https://github.com/philips-software/roslyn-analyzers/blob/main/Philips.CodeAnalysis.MsTestAnalyzers/PreferCombinatorialTestingAnalyzer.cs)
| CodeFix  | No |
| Severity | Info |
| Enabled By Default | No |

## Introduction

Test methods with multiple DataRow attributes may benefit from using combinatorial testing instead. Combinatorial testing allows you to test multiple combinations of parameter values more efficiently using the `Combinatorial.MSTest` package.

## How to solve

Consider refactoring your test method to use combinatorial testing with the `Combinatorial.MSTest` package. This can make your tests more maintainable when you have many parameter combinations.

First, install the Combinatorial.MSTest package:
```xml
<PackageReference Include="Combinatorial.MSTest" Version="1.0.11" />
```

Then refactor your test to use `CombinatorialValues` attributes.

## Example

Code that triggers a diagnostic:
``` cs
[TestMethod]
[DataRow("private static readonly", false)]
[DataRow("private static", false)]
[DataRow("private const", false)]
[DataRow("private", false)]
[DataRow("public static readonly", true)]
[DataRow("public const", true)]
[DataRow("public static", true)]
[DataRow("public readonly", true)]
[DataRow("public", true)]
[TestCategory(TestDefinitions.UnitTests)]
public void TestMethodWithManyDataRows(string modifiers, bool expected)
{
    // Test implementation
}
```

Potential refactored code using combinatorial testing:
``` cs
[TestMethod]
[TestCategory(TestDefinitions.UnitTests)]
public void TestMethodWithCombinatorialValues(
    [CombinatorialValues("private", "public", "internal", "protected")] string visibility,
    [CombinatorialValues("", "static", "readonly", "const")] string modifier,
    [CombinatorialValues(true, false)] bool expected)
{
    var modifiers = $"{visibility} {modifier}".Trim();
    // Test implementation
}
```

**Note**: The `Combinatorial.MSTest` package may not work with all parameter combinations and has limitations when mixing combinatorial and non-combinatorial parameters. Evaluate whether the refactoring is appropriate for your specific test case.

## Configuration

This analyzer is disabled by default. To enable it, add the following to your .editorconfig:

```ini
dotnet_diagnostic.PH2159.severity = suggestion
```

The analyzer triggers when a test method has 4 or more DataRow attributes.

The general ways of [suppressing](https://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/suppress-warnings) diagnostics apply.