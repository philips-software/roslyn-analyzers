# PH2164: String-keyed collections should specify a StringComparer

| Property | Value  |
|--|--|
| Package | [Philips.CodeAnalysis.MaintainabilityAnalyzers](https://www.nuget.org/packages/Philips.CodeAnalysis.MaintainabilityAnalyzers) |
| Diagnostic ID | PH2164 |
| Category  | [Maintainability](../Maintainability.md) |
| Analyzer | [StringDictionaryNeedsComparerAnalyzer](https://github.com/philips-software/roslyn-analyzers/blob/main/Philips.CodeAnalysis.MaintainabilityAnalyzers/Maintainability/StringDictionaryNeedsComparerAnalyzer.cs)
| CodeFix  | No |
| Severity | Error |
| Enabled By Default | Yes |

## Introduction

String-keyed collections should explicitly specify a StringComparer (or IComparer<string> for sorted collections) to avoid culture-dependent or case-sensitivity surprises. Without an explicit comparer, collections may use culture-sensitive string comparisons that can lead to unexpected behavior in different locales.

## How to solve

Explicitly specify a StringComparer when creating string-keyed collections:

- For equality-based collections: Use `StringComparer.Ordinal`, `StringComparer.OrdinalIgnoreCase`, or other appropriate StringComparer options
- For sorted collections: Use `StringComparer.Ordinal` (cast to IComparer<string>) or other appropriate comparer

## Example

Code that triggers a diagnostic:
``` cs
class BadExample
{
    public void BadMethod()
    {
        // Missing StringComparer - uses default culture-sensitive comparison
        var dict = new Dictionary<string, int>();
        var set = new HashSet<string>();
        
        // Also problematic for sorted collections
        var sortedDict = new SortedDictionary<string, int>();
        var sortedSet = new SortedSet<string>();
    }
}
```

And the improved replacement:
``` cs
class GoodExample
{
    public void GoodMethod()
    {
        // Explicit StringComparer for predictable behavior
        var dict = new Dictionary<string, int>(StringComparer.Ordinal);
        var set = new HashSet<string>(StringComparer.OrdinalIgnoreCase);
        
        // Explicit comparer for sorted collections
        var sortedDict = new SortedDictionary<string, int>(StringComparer.Ordinal);
        var sortedSet = new SortedSet<string>(StringComparer.OrdinalIgnoreCase);
    }
}
```

## Supported Collections

The analyzer detects the following string-keyed collection types:

- `Dictionary<string, TValue>`
- `HashSet<string>`
- `ConcurrentDictionary<string, TValue>` (planned)
- `SortedDictionary<string, TValue>` (planned)
- `SortedSet<string>` (planned)
- `ImmutableDictionary<string, TValue>` (planned)

## Configuration

This analyzer is enabled by default. The general ways of [suppressing](https://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/suppress-warnings) diagnostics apply.