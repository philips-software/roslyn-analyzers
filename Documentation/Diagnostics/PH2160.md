# PH2160: Use combinatorial testing

| Property | Value  |
|--|--|
| Package | [Philips.CodeAnalysis.MsTestAnalyzers](https://www.nuget.org/packages/Philips.CodeAnalysis.MsTestAnalyzers) |
| Diagnostic ID | PH2160 |
| Category  | [MsTest](../MsTest.md) |
| Analyzer | [PreferCombinatorialTestingAnalyzer](https://github.com/philips-software/roslyn-analyzers/blob/main/Philips.CodeAnalysis.MsTestAnalyzers/PreferCombinatorialTestingAnalyzer.cs)
| CodeFix  | Yes |
| Severity | Info |
| Enabled By Default | No |

## Introduction

Test methods with parameters and multiple DataRow attributes can be simplified using CombinatorialValues from the `Combinatorial.MSTest` package. This analyzer detects two specific scenarios:

1. **Single-parameter methods** with 4+ DataRow attributes (each with a single argument)
2. **Two-parameter methods** with DataRow attributes covering all possible combinations

This makes tests more maintainable and concise when you have many values to test.

## How to solve

Consider refactoring your test method to use CombinatorialValues with the `Combinatorial.MSTest` package. The analyzer provides a code fixer that automatically converts DataRow attributes to CombinatorialValues parameters.

First, install the Combinatorial.MSTest package:
```xml
<PackageReference Include="Combinatorial.MSTest" Version="1.0.11" />
```

Then apply the code fixer, or manually refactor your test to use `CombinatorialValues` attributes on the parameters.

## Examples

### Single Parameter Case

Code that triggers a diagnostic:
``` cs
[TestMethod]
[DataRow("private")]
[DataRow("public")]
[DataRow("internal")]
[DataRow("protected")]
[DataRow("static")]
[DataRow("readonly")]
[DataRow("const")]
[TestCategory(TestDefinitions.UnitTests)]
public void TestMethodWithManyDataRows(string modifier)
{
    // Test implementation
}
```

Refactored code using CombinatorialValues:
``` cs
[TestMethod]
[TestCategory(TestDefinitions.UnitTests)]
public void TestMethodWithCombinatorialValues(
    [CombinatorialValues("private", "public", "internal", "protected", "static", "readonly", "const")] string modifier)
{
    // Test implementation
}
```

### Two Parameter Case

Code that triggers a diagnostic (all combinations present):
``` cs
[TestMethod]
[DataRow(true, "small")]
[DataRow(true, "medium")]
[DataRow(true, "large")]
[DataRow(false, "small")]
[DataRow(false, "medium")]
[DataRow(false, "large")]
[TestCategory(TestDefinitions.UnitTests)]
public void TestMethodWithAllCombinations(bool enabled, string size)
{
    // Test implementation
}
```

Refactored code using CombinatorialValues:
``` cs
[TestMethod]
[TestCategory(TestDefinitions.UnitTests)]
public void TestMethodWithCombinatorialValues(
    [CombinatorialValues(true, false)] bool enabled,
    [CombinatorialValues("small", "medium", "large")] string size)
{
    // Test implementation
}
```

## Configuration

This analyzer is disabled by default. To enable it, add the following to your .editorconfig:

```ini
dotnet_diagnostic.PH2160.severity = suggestion
```

The analyzer triggers when:
- A test method has exactly 1 parameter with 4 or more DataRow attributes (each with exactly 1 argument), OR
- A test method has exactly 2 parameters with DataRow attributes covering all possible value combinations

The general ways of [suppressing](https://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/suppress-warnings) diagnostics apply.