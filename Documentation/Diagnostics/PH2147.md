# PH2147: Avoid unnecessary typed discards and variables named '_'

| Property | Value  |
|--|--|
| Package | [Philips.CodeAnalysis.MaintainabilityAnalyzers](https://www.nuget.org/packages/Philips.CodeAnalysis.MaintainabilityAnalyzers) |
| Diagnostic ID | PH2147 |
| Category  | [Naming](../Naming.md) |
| Analyzer | [AvoidVariableNamedUnderscoreAnalyzer](https://github.com/philips-software/roslyn-analyzers/blob/main/Philips.CodeAnalysis.MaintainabilityAnalyzers/Naming/AvoidVariableNamedUnderscoreAnalyzer.cs)
| CodeFix  | No |
| Severity | Error |
| Enabled By Default | Yes |

## Introduction

This rule flags:
1. **Unnecessary typed discards**: Typed discards like `out string _` when anonymous discard `out _` would work equally well
2. **Variables named exactly `_`**: Local variables, foreach variables, for loop variables, using variables, and out parameters that are named exactly `_` (single underscore)

This rule does not flag proper C# anonymous discards (`_`) or typed discards that are necessary for overload resolution.

## Reason

**For unnecessary typed discards**: Anonymous discards have clearer intent and are more concise than typed discards when the type information is not needed for overload resolution.

**For variables named `_`**: Variables named exactly `_` can be confused with C# discards. This can lead to unintended behavior where developers think they are using a discard but are actually creating a variable that captures the value.

## How to fix violations

**For unnecessary typed discards**: Replace typed discards with anonymous discards when the type is not needed for overload resolution.

**For variables named `_`**: Either use a proper discard (if you don't need the value) or use a more descriptive variable name (if you do need the value).

## Examples

### Unnecessary Typed Discards (Flagged)

```csharp
// These are flagged - unnecessary typed discards when anonymous would work
GetValue(out string _);           // Should be: GetValue(out _);
TryParseHelper("123", out int _); // Should be: TryParseHelper("123", out _);

public void GetValue(out string value) { value = "test"; }
public bool TryParseHelper(string input, out int result) { result = 42; return true; }
```

### Necessary Typed Discards (NOT Flagged)

```csharp
// These are NOT flagged - necessary for overload resolution
Parse("123", out int _);          // Disambiguates from Parse(string, out string)
Parse("test", out string _);      // Disambiguates from Parse(string, out int)

// Example overloaded methods
public bool Parse(string input, out int result) { result = 42; return true; }
public bool Parse(string input, out string result) { result = input; return true; }
```

### Variables Named '_' (Flagged)

```csharp
// Local variable - looks like discard but is actually a variable
byte[] _ = ExtractData(reader);

// ForEach variable - confusing
foreach (var _ in items)
{
    // code
}

// Out parameter with explicit variable named _ - confusing
if (int.TryParse(input, out var _))
{
    // The variable _ captures the value but looks like a discard
}
```

### Correct Usage (NOT Flagged)

```csharp
// Use proper anonymous discards - these are NOT flagged
_ = ExtractData(reader);              // Anonymous discard assignment
GetValue(out _);                      // Anonymous discard in out parameter
TryParseHelper("123", out _);         // Anonymous discard in out parameter

// Use descriptive names when you need the value
byte[] data = ExtractData(reader);
foreach (var item in items)
{
    // Use item
}

if (int.TryParse(input, out int result))
{
    // Use result
}

// Typed discards are allowed when needed for overload resolution
Parse("123", out int _);       // Needed to select correct overload
Parse("test", out string _);   // Needed to select correct overload
```

## Configuration

This rule is enabled by default with Error severity.

## Suppression

```csharp
[SuppressMessage("Philips.CodeAnalysis.MaintainabilityAnalyzers", "PH2147:Avoid unnecessary typed discards and variables named '_'", Justification = "Reviewed.")]
```